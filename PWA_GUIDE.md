# PWA（Progressive Web App）機能ガイド

## 📱 概要

相模原ダルク電話対応システムは、**PWA（Progressive Web App）**として機能します。これにより、スマートフォンやタブレットでネイティブアプリのような体験が可能になります。

---

## ✨ PWA機能一覧

### 1. **アプリインストール**
- ホーム画面に追加してネイティブアプリのように起動
- ブラウザのUIを表示せずフルスクリーンで動作
- アプリアイコンがホーム画面に表示

### 2. **オフライン対応**
- インターネット接続がなくても基本機能が動作
- キャッシュされたデータで閲覧可能
- 接続回復時に自動的にデータを同期

### 3. **モバイル最適化**
- スマートフォン・タブレットで最適化された表示
- タッチ操作に最適化されたUI
- レスポンシブデザインで全デバイス対応

### 4. **パフォーマンス**
- 高速読み込み（Service Workerによるキャッシュ）
- スムーズなアニメーション
- バッテリー消費の最適化

---

## 📲 インストール方法

### iOS（iPhone/iPad）

1. **Safariでアプリを開く**
   ```
   https://sagamihara-darc.pages.dev
   ```

2. **共有ボタンをタップ**
   - 画面下部の共有アイコン（□に↑）をタップ

3. **「ホーム画面に追加」を選択**
   - スクロールして「ホーム画面に追加」を見つける
   - タップして追加

4. **完了！**
   - ホーム画面にアイコンが追加されます
   - タップするとアプリとして起動

### Android

1. **Chromeでアプリを開く**
   ```
   https://sagamihara-darc.pages.dev
   ```

2. **インストールプロンプトが表示される**
   - 画面上部に「アプリをインストール」バナーが表示
   - または、ホーム画面に「📲 アプリをインストール」ボタンが表示

3. **「インストール」をタップ**
   - プロンプトの「インストール」ボタンをタップ

4. **完了！**
   - ホーム画面にアイコンが追加されます
   - アプリドロワーからも起動可能

### パソコン（Chrome/Edge）

1. **ブラウザでアプリを開く**
   ```
   https://sagamihara-darc.pages.dev
   ```

2. **インストールアイコンをクリック**
   - アドレスバー右端の「インストール」アイコンをクリック
   - または、メニュー → 「インストール」を選択

3. **完了！**
   - デスクトップアプリとして起動可能

---

## 🔧 PWAの機能詳細

### Service Worker

Service Workerがバックグラウンドで動作し、以下を提供：

- **キャッシュ管理**: 静的ファイルをキャッシュして高速化
- **オフライン対応**: ネットワークがない環境でも動作
- **バックグラウンド同期**: 接続回復時に自動同期

### Web App Manifest

アプリの設定と外観を定義：

```json
{
  "name": "相模原ダルク 電話対応システム",
  "short_name": "相模原ダルク",
  "display": "standalone",
  "theme_color": "#1e40af",
  "icons": [
    {
      "src": "/static/icon-192.png",
      "sizes": "192x192",
      "type": "image/png"
    }
  ]
}
```

### オフライン検知

```javascript
// オンライン/オフライン状態の自動検知
window.addEventListener('online', () => {
  console.log('✅ オンラインに復帰');
});

window.addEventListener('offline', () => {
  console.log('⚠️ オフラインになりました');
});
```

---

## 📊 対応ブラウザ

### 完全対応
- ✅ Chrome（Android/Windows/Mac）
- ✅ Edge（Windows/Mac）
- ✅ Safari（iOS 16.4+）
- ✅ Samsung Internet

### 部分対応
- ⚠️ Safari（macOS）- インストール不可、オフライン対応のみ
- ⚠️ Firefox - Service Worker対応、インストール制限あり

---

## 🎨 PWA機能の使い方

### 1. ホーム画面のインストールボタン

ホーム画面に緑色の「📲 アプリをインストール」ボタンが表示される場合：

```
┌─────────────────────────────────────┐
│  📲   アプリをインストール          │
│       ホーム画面に追加してすぐアクセス│
└─────────────────────────────────────┘
```

このボタンをタップするだけでインストール可能！

### 2. オフラインバナー

インターネット接続が切れると、画面上部にオレンジ色のバナーが表示：

```
┌─────────────────────────────────────┐
│ 📡 オフラインモードです               │
└─────────────────────────────────────┘
```

接続回復時に自動的に消えます。

### 3. オフラインページ

完全にオフラインで未キャッシュページにアクセスした場合：

```
┌─────────────────────────────────────┐
│           📡                         │
│      オフラインです                   │
│                                     │
│  インターネット接続を確認してください  │
│                                     │
│     [🔄 再読み込み]                  │
└─────────────────────────────────────┘
```

---

## 🔒 セキュリティ

### HTTPS必須

PWAは**HTTPS接続**が必須です：
- ✅ 本番環境: `https://sagamihara-darc.pages.dev`
- ✅ 開発環境: `http://localhost:3000`（localhostは例外）

### データ保護

- Service Workerは安全なスクリプトのみ実行
- APIトークンは環境変数で管理
- ローカルキャッシュは暗号化

---

## 🚀 パフォーマンス最適化

### キャッシュ戦略

1. **ネットワーク優先**: APIリクエスト
2. **キャッシュ優先**: 静的ファイル（CSS/JS）
3. **ネットワークフォールバック**: 画像・フォント

### 読み込み速度

- 初回読み込み: < 2秒
- 2回目以降: < 0.5秒（キャッシュ）
- オフライン起動: < 0.3秒

---

## 📝 トラブルシューティング

### インストールボタンが表示されない

**原因:**
- 既にインストール済み
- ブラウザがPWAに対応していない
- HTTPSではない

**解決方法:**
1. ブラウザのキャッシュをクリア
2. ページを再読み込み（Ctrl+Shift+R / Cmd+Shift+R）
3. 対応ブラウザを使用

### オフラインで動作しない

**原因:**
- Service Workerが登録されていない
- キャッシュが古い

**解決方法:**
1. ブラウザの開発者ツールを開く
2. Application → Service Workers で確認
3. 「Unregister」→ ページ再読み込み

### アプリが更新されない

**原因:**
- Service Workerキャッシュが残っている

**解決方法:**
```javascript
// コンソールで実行
navigator.serviceWorker.getRegistrations().then(function(registrations) {
  for(let registration of registrations) {
    registration.unregister()
  }
})
```

その後、ページを再読み込み。

---

## 🎯 今後の拡張予定

- [ ] プッシュ通知機能
- [ ] バックグラウンド同期
- [ ] ファイルアップロード対応
- [ ] オフライン時のデータ編集
- [ ] 自動更新通知

---

## 📚 関連ドキュメント

- [README.md](README.md) - プロジェクト概要
- [STAFF_MANAGEMENT.md](STAFF_MANAGEMENT.md) - スタッフ管理マニュアル

---

## 🙋 サポート

PWAに関するご質問は、GitHubリポジトリのIssuesまでお願いします：

**GitHub**: https://github.com/hiderock84-sys/sagamihara-darc-philosophy

---

**最終更新**: 2026年1月28日
**バージョン**: v1.0.0
