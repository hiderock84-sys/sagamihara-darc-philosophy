# 相模原ダルク 電話対応支援システム

## 📋 プロジェクト概要

一般社団法人相模原ダルクの電話相談業務を効率化・標準化するための電話対応支援Webアプリケーションです。
電話対応マニュアルに基づいた段階的なガイド機能と、相談記録の管理・分析機能を提供します。

### 代表理事
**田中秀泰** - 薬物・アルコール・ギャンブル依存症者及びその家族への回復支援と社会復帰をサポート

## 🎯 主な機能

### ✅ 現在完成している機能

1. **新規相談受付システム**
   - 段階的電話対応ガイド（オープニング→傾聴→情報提供→クロージング）
   - リアルタイム対応フレーズ表示（OK例・NG例・ルール・注意事項）
   - 詳細な相談記録シート入力フォーム
   - 緊急度評価システム（高・中・低の3段階）
   - チェックリスト機能

2. **相談履歴管理システム**
   - 過去の相談記録一覧表示
   - 詳細検索機能（キーワード、緊急度、日付範囲）
   - ページネーション（20件ずつ表示）
   - 相談記録詳細表示
   - 記録のクイックフィルター

3. **統計ダッシュボード**
   - 総相談件数・今月の相談件数
   - 緊急度別統計（グラフ可視化）
   - 依存症種類別統計（上位5件）
   - 最近の相談一覧（5件）
   - Chart.jsによるインタラクティブなグラフ

4. **対応マニュアル閲覧**
   - 段階別フレーズ集の表示
   - OK例・NG例・ルール・注意事項の分類表示
   - 緊急対応フロー
   - 検索可能なマニュアルデータベース

5. **エクスポート機能**
   - CSV形式でのデータ一括出力
   - PDF形式での個別記録出力（印刷対応）
   - Excel互換のCSV（BOM付きUTF-8）

6. **データベース管理**
   - Cloudflare D1による永続的データ保存
   - 相談記録の完全管理
   - スタッフ情報管理
   - 対応フレーズ集管理

7. **API機能**
   - RESTful API設計
   - スタッフ一覧取得
   - 対応フレーズ取得（カテゴリー別）
   - 相談記録CRUD操作
   - 検索機能
   - 統計情報取得

### 🚧 今後実装予定の機能

1. **認証・権限管理**
   - スタッフログイン機能
   - 役割別アクセス制御

2. **通知機能**
   - フォローアップのリマインダー
   - 緊急度「高」の通知

3. **モバイル最適化**
   - タブレット・スマホ対応の強化
   - PWA（Progressive Web App）化

## 🌐 公開URL

### 開発環境（Sandbox）
- **アプリURL**: https://3000-iko5o0a9up8u6girs6d0a-2e77fc33.sandbox.novita.ai
- **API Base**: https://3000-iko5o0a9up8u6girs6d0a-2e77fc33.sandbox.novita.ai/api

### 本番環境（デプロイ後）
- **Production URL**: （デプロイ後に追加）
- **GitHub Repository**: （GitHub連携後に追加）

## 📊 データアーキテクチャ

### データモデル

#### 1. 相談記録（consultations）
- 受付情報（日時、対応者）
- 基本情報（名前、年齢、性別、電話番号、相談者の関係）
- 依存症情報（種類、期間、頻度、重症度）
- 医療・治療歴（入院歴、通院歴、服薬状況、他施設利用）
- 緊急度評価（24時間以内使用、離脱症状、自傷他害、医療必要性、判定レベル）
- 相談内容・特記事項
- 次のアクション（面談予約、フォローアップ、連携先、報告）
- チェックリスト（6項目）

#### 2. 対応フレーズ（response_phrases）
- カテゴリー（opening, listening, information, closing, emergency）
- 段階（第1〜4段階）
- フレーズ種類（OK例、NG例、ルール、注意）
- フレーズ内容

#### 3. スタッフ（staff）
- 名前
- 役職（代表理事、上級スタッフ、スタッフ）
- 有効/無効フラグ

### ストレージサービス
- **Cloudflare D1（SQLite）**: 全データの永続化
- **ローカル開発**: `.wrangler/state/v3/d1`に自動作成されるSQLiteデータベース

### データフロー
1. フロントエンド（JavaScript）→ Hono API（TypeScript）
2. Hono API → Cloudflare D1 Database
3. データベース → API → フロントエンド

## 📱 依存症対応範囲

以下の依存症に対応しています：
- アルコール依存
- 薬物依存
- ギャンブル依存
- ゲーム依存
- ネット・スマホ依存
- 処方薬・市販薬依存
- 窃盗（クレプトマニア）
- 性依存
- 共依存
- 食行動の問題
- その他

## 👥 利用ガイド

### 新規相談を受ける場合

1. **ホーム画面**から「新規相談受付」をクリック
2. **左側の対応ガイド**を参考にしながら電話対応
3. **右側の記録シート**に情報を入力：
   - 受付情報（日時、対応者名）を入力
   - 相談者の基本情報を記録
   - 依存症の種類や状況を選択
   - 緊急度を評価（重要！）
   - 相談内容を詳細に記録
   - 次のアクション（面談予約など）を設定
4. **チェックリスト**を確認
5. 「相談記録を保存」ボタンをクリック

### 対応の4段階

#### 第1段階: オープニング（0-30秒）
- 名前を名乗り、相手の話を聞く姿勢を示す
- 例：「お電話ありがとうございます。相模原ダルクの〇〇と申します。本日はどのようなご相談でしょうか？」

#### 第2段階: 傾聴・共感（30秒-5分）
- 相手の話を遮らず、最後まで聞く
- 共感を示す言葉をかける
- 例：「そうだったんですね。それはとてもお辛い状況だったと思います。」

#### 第3段階: 情報提供（5-10分）
- 施設概要を説明（30秒スピーチ）
- 対応可能な依存症を伝える
- 面談予約の案内

#### 第4段階: クロージング
- 名前・連絡先の確認
- 緊急度の評価
- フォローアップ日の設定
- 例：「本日はお電話いただき、ありがとうございました。◯月◯日の◯時にお待ちしております。」

### 緊急対応が必要な場合

以下の場合は最優先対応：
- ✅ 24時間以内の使用がある
- ✅ 離脱症状がある
- ✅ 自傷・他害の恐れがある
- ✅ 医療機関への受診が必要

→ **緊急度「高」**を選択し、即日対応をスケジュール

## 🚀 デプロイ状況

### ローカル開発環境
- ✅ 開発環境構築完了
- ✅ データベースマイグレーション完了
- ✅ 初期データ投入完了
- ✅ テストデータ8件追加
- ✅ PM2によるサービス起動完了
- ✅ API動作確認完了
- ✅ 全機能実装完了

### 本番環境（Cloudflare Pages）
- ⏳ デプロイ待ち

## 📊 実装済み機能の詳細

### 相談履歴管理
- **一覧表示**: 全相談記録をカード形式で表示
- **検索機能**: キーワード、緊急度、日付範囲で絞り込み
- **ページネーション**: 20件ずつの表示、前後ページ移動
- **詳細表示**: クリックで詳細情報を表示
- **エクスポート**: 各記録からPDF出力が可能

### 統計ダッシュボード
- **概要カード**: 4つの主要指標を大きく表示
- **緊急度別グラフ**: ドーナツチャートで視覚化
- **依存症種類別グラフ**: 横棒グラフで上位5件を表示
- **最近の相談**: 直近5件の相談をリスト表示
- **インタラクティブ**: Chart.jsによる動的グラフ

### エクスポート機能
- **CSV一括出力**: 全相談記録をCSV形式で出力
- **Excel対応**: BOM付きUTF-8でExcelで正しく開ける
- **PDF個別出力**: 各相談記録を印刷可能なPDF形式で出力
- **自動命名**: ファイル名に日付を自動付与

## 💻 技術スタック

### フロントエンド
- **HTML5 + JavaScript (ES6+)**
- **Tailwind CSS** (CDN) - レスポンシブデザイン
- **Font Awesome** - アイコン
- **Axios** - HTTP通信
- **SPA Architecture** - シングルページアプリケーション

### バックエンド
- **Hono Framework** - 高速軽量Webフレームワーク
- **TypeScript** - 型安全な開発
- **Cloudflare Workers** - エッジランタイム
- **Cloudflare Pages** - ホスティング

### データベース
- **Cloudflare D1** - SQLiteベースのグローバル分散データベース
- **Wrangler** - CLIツール

### 開発環境
- **Vite** - ビルドツール
- **PM2** - プロセスマネージャー
- **Git** - バージョン管理

## 📈 推奨される次のステップ

1. **本番デプロイ** - Cloudflare Pages へのデプロイ
2. **認証機能の実装** - スタッフごとのログイン
3. **通知機能の追加** - フォローアップリマインダー
4. **データバックアップ** - 定期的な自動バックアップ
5. **モバイル最適化** - タブレット・スマホ対応強化
6. **アクセスログ機能** - 利用状況の追跡

## 🎨 使用技術の詳細

### グラフ・可視化
- **Chart.js 4.4.0** - 緊急度別・依存症種類別グラフの描画
  - ドーナツチャート（緊急度）
  - 横棒グラフ（依存症種類）
  - レスポンシブ対応

### データ処理
- **Axios** - HTTPリクエスト処理
- **JSON処理** - 複雑なデータ構造の管理
- **日付フォーマット** - 日本語ロケール対応

### UI/UX
- **Tailwind CSS** - レスポンシブデザイン
- **Font Awesome** - 豊富なアイコン
- **アニメーション** - フェードイン・ホバー効果

## 📝 データ構造

### 相談記録（consultations）テーブル
```sql
- id: 自動採番
- reception_datetime: 受付日時
- staff_name: 対応者名
- caller_*: 相談者情報（名前、年齢、性別、電話、関係）
- addiction_*: 依存症情報（種類、期間、頻度、重症度）
- hospitalization_*, outpatient_*: 医療・治療歴
- emergency_*: 緊急度評価（4項目のチェック + 判定）
- consultation_content: 相談内容
- notes: 特記事項
- interview_*, followup_*: 次のアクション
- check_*: 対応完了チェックリスト（6項目）
- created_at, updated_at: タイムスタンプ
```

### 現在のデータ状況
- **スタッフ**: 3名（田中秀泰代表理事、上級スタッフA、スタッフB）
- **対応フレーズ**: 約20件（4段階 + 緊急対応）
- **テスト相談記録**: 8件（様々な依存症パターン）

## 📞 お問い合わせ

**一般社団法人相模原ダルク**
- 代表理事: 田中秀泰
- 事業内容: 薬物・アルコール・ギャンブル依存症からの回復支援と社会復帰サポート
- 対象: 在日外国人、貧困家庭、機能不全家族、特に子どもたちへの包括的支援

## 📄 ライセンス

© 2026 一般社団法人相模原ダルク - All Rights Reserved

---

**最終更新日**: 2026年1月26日  
**開発状況**: ✅ 全コア機能完成 | 🚀 デプロイ準備完了

## 🎉 完成した機能一覧

### ✅ 実装完了
- [x] 新規相談受付システム
- [x] 段階的電話対応ガイド
- [x] 相談記録データベース
- [x] 相談履歴管理・検索
- [x] 統計ダッシュボード（グラフ可視化）
- [x] 対応マニュアル閲覧
- [x] CSV/PDFエクスポート
- [x] RESTful API
- [x] レスポンシブデザイン

### 🚧 今後の拡張
- [ ] 認証・権限管理
- [ ] 通知・リマインダー
- [ ] データバックアップ自動化
- [ ] PWA化（オフライン対応）
